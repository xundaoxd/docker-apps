#!/usr/bin/env bash

self_path=$(realpath $0)
bin_path=$(dirname $self_path)
docker_path=$(dirname $bin_path)

base_opt="--rm -u $(id -u):$(id -g) \
    -h $(hostname) \
    -v $docker_path/.home:$HOME \
    -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix \
    -e LANG=\"C.UTF-8\" -e GTK_IM_MODULE=\"xim\" -e QT_IM_MODULE=\"xim\" -e XMODIFIERS"

cwd_opt="-v $PWD:$PWD -w $PWD"

home_opt="-v $HOME/Documents:$HOME/Documents:ro \
    -v $HOME/Downloads:$HOME/Downloads:ro \
    -v $HOME/Pictures:$HOME/Pictures:ro \
    -v $HOME/Desktop:$HOME/Desktop:ro"

pulse_opt="-e PULSE_SERVER=unix:/run/user/1000/pulse/native \
    -v /run/user/1000/pulse:/run/user/1000/pulse"

# nodejs
node() {
    docker run $cwd_opt $base_opt -ti node:latest node "$@"
}
npm() {
    docker run $cwd_opt $base_opt -ti node:latest npm "$@"
}
yarn() {
    docker run $cwd_opt $base_opt -ti node:latest yarn "$@"
}
npx() {
    docker run $cwd_opt $base_opt -ti node:latest npx "$@"
}

# java
java() {
    docker run $cwd_opt $base_opt -ti openjdk:latest java "$@"
}
javac() {
    docker run $cwd_opt $base_opt -ti openjdk:latest javac "$@"
}

# go
go() {
    docker run $cwd_opt $base_opt -ti xundaoxd/go:latest go "$@"
}

# cuda
nvcc() {
    docker run $cwd_opt $base_opt -ti --gpus all xundaoxd/cuda-cmake:latest nvcc "$@"
}
nvdisasm() {
    docker run $cwd_opt $base_opt -ti --gpus all xundaoxd/cuda-cmake:latest nvdisasm "$@"
}
cuobjdump() {
    docker run $cwd_opt $base_opt -ti --gpus all xundaoxd/cuda-cmake:latest cuobjdump "$@"
}
cmake() {
    docker run $cwd_opt $base_opt -ti --gpus all xundaoxd/cuda-cmake:latest cmake "$@"
}

# others
obsidian() {
    docker run $cwd_opt $home_opt $base_opt --gpus all \
        -d xundaoxd/obsidian:latest \
        /opt/obsidian/obsidian --no-sandbox "$@"
}
octave() {
    docker run $cwd_opt $base_opt -d xundaoxd/octave:latest \
        octave --gui "$@"
}
vlc() {
    docker run $cwd_opt $base_opt $pulse_opt \
        -d xundaoxd/vlc:latest \
        vlc "$@"
}
gimp() {
    docker run $cwd_opt $base_opt -d xundaoxd/gimp:latest \
        gimp "$@"
}
manim() {
    docker run $cwd_opt $base_opt -v $(pwd):/manim \
        -ti manimcommunity/manim:latest \
        manim "$@"
}
xelatex() {
    docker run $cwd_opt $base_opt -ti texlive/texlive:latest \
        xelatex "$@"
}
doxygen() {
    docker run $cwd_opt $base_opt -ti xundaoxd/doxygen:latest \
        doxygen "$@"
}
you-get() {
    docker run $cwd_opt $base_opt -ti xundaoxd/you-get:latest \
        you-get "$@"
}
blender() {
    docker run $base_opt $cwd_opt $pulse_opt --gpus all \
        -d xundaoxd/blender:latest /usr/bin/blender
}

main() {
    self=$(basename $0)
    $self "$@"
}

main "$@"
