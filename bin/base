#!/usr/bin/env bash

self_path=$(realpath $0)
bin_path=$(dirname $self_path)
docker_path=$(dirname $bin_path)

docker_base() {
    docker run --rm -u $(id -u):$(id -g) \
        -h $(hostname) \
        -v $docker_path/.home:$HOME \
        -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix \
        -e LANG="C.UTF-8" -e GTK_IM_MODULE="xim" -e QT_IM_MODULE="xim" -e XMODIFIERS \
        "$@"
}

docker_cwd() {
    prev="$1"
    shift 1
    $prev \
        -v $PWD:$PWD -w $PWD \
        "$@"
}

docker_home() {
    prev="$1"
    shift 1
    $prev \
        -v $HOME/Documents:$HOME/Documents:ro \
        -v $HOME/Downloads:$HOME/Downloads:ro \
        -v $HOME/Pictures:$HOME/Pictures:ro \
        -v $HOME/Desktop:$HOME/Desktop:ro \
        "$@"
}

# nodejs
node() {
    docker_cwd docker_base -ti node:latest node "$@"
}
npm() {
    docker_cwd docker_base -ti node:latest npm "$@"
}
yarn() {
    docker_cwd docker_base -ti node:latest yarn "$@"
}
npx() {
    docker_cwd docker_base -ti node:latest npx "$@"
}

# java
java() {
    docker_cwd docker_base -ti openjdk:latest java "$@"
}
javac() {
    docker_cwd docker_base -ti openjdk:latest javac "$@"
}

# go
go() {
    docker_cwd docker_base -ti xundaoxd/go:latest go "$@"
}

# cuda
nvcc() {
    docker_cwd docker_base -ti --gpus all xundaoxd/cuda-cmake:latest nvcc "$@"
}
nvdisasm() {
    docker_cwd docker_base -ti --gpus all xundaoxd/cuda-cmake:latest nvdisasm "$@"
}
cuobjdump() {
    docker_cwd docker_base -ti --gpus all xundaoxd/cuda-cmake:latest cuobjdump "$@"
}
cmake() {
    docker_cwd docker_base -ti --gpus all xundaoxd/cuda-cmake:latest cmake "$@"
}

# others
obsidian() {
    docker_cwd docker_home docker_base --gpus all \
        -d xundaoxd/obsidian:latest \
        /opt/obsidian/obsidian --no-sandbox "$@"
}
octave() {
    docker_cwd docker_base -d xundaoxd/octave:latest \
        octave --gui "$@"
}
vlc() {
    docker_cwd docker_base -e PULSE_SERVER=unix:/run/user/1000/pulse/native \
        -v /run/user/1000/pulse:/run/user/1000/pulse \
        -d xundaoxd/vlc:latest \
        vlc "$@"
}
gimp() {
    docker_cwd docker_base -d xundaoxd/gimp:latest \
        gimp "$@"
}
manim() {
    docker_cwd docker_base -v $(pwd):/manim \
        -ti manimcommunity/manim:latest \
        manim "$@"
}
xelatex() {
    docker_cwd docker_base -ti texlive/texlive:latest \
        xelatex "$@"
}
doxygen() {
    docker_cwd docker_base -ti xundaoxd/doxygen:latest \
        doxygen "$@"
}
you-get() {
    docker_cwd docker_base -ti xundaoxd/you-get:latest \
        you-get "$@"
}

main() {
    self=$(basename $0)
    $self "$@"
}

main "$@"
