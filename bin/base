#!/usr/bin/env bash

self_path=$(realpath $0)
bin_path=$(dirname $self_path)
docker_path=$(dirname $bin_path)

base_opt() {
    echo "-u $(id -u):$(id -g) \
    -h $(hostname) \
    -v $docker_path/.home:$HOME"
}

cwd_opt() {
    if [[ "$PWD" != "$HOME" ]]; then
        echo "-v $PWD:$PWD -w $PWD"
    else
        echo "-w $PWD"
    fi
}

base() {
    docker run --network host $(base_opt) $(cwd_opt) "$@"
}

# nodejs
node() {
    base -ti --rm node:latest node "$@"
}
npm() {
    base -ti --rm node:latest npm "$@"
}
yarn() {
    base -ti --rm node:latest yarn "$@"
}
npx() {
    base -ti --rm node:latest npx "$@"
}

# java
java() {
    base -ti --rm openjdk:latest java "$@"
}
javac() {
    base -ti --rm openjdk:latest javac "$@"
}

# go
go() {
    base -ti --rm --gpus all xundaoxd/ml:latest go "$@"
}

# cuda
mllab() {
    base -ti --rm --gpus all xundaoxd/ml:latest "$@"
}
nvcc() {
    base -ti --rm --gpus all xundaoxd/ml:latest nvcc "$@"
}
nvdisasm() {
    base -ti --rm --gpus all xundaoxd/ml:latest nvdisasm "$@"
}
cuobjdump() {
    base -ti --rm --gpus all xundaoxd/ml:latest cuobjdump "$@"
}
cmake() {
    base -ti --rm --gpus all xundaoxd/ml:latest cmake "$@"
}
bazel() {
    base -ti --rm --gpus all xundaoxd/ml:latest bazel "$@"
}
ipython() {
    base -ti --rm --gpus all xundaoxd/ml:latest \
        ipython "$@"
}
jupyter() {
    base -ti --rm --gpus all xundaoxd/ml:latest \
        jupyter lab --no-browser
}


# others
xelatex() {
    base -ti --rm texlive/texlive:latest \
        xelatex "$@"
}

main() {
    self=$(basename $0)
    $self "$@"
}

main "$@"
